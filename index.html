<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tsinghua University - PV Effect Simulation</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 10px;
            color: #2c3e50;
        }
        /* Responsive Header */
        .header { 
            text-align: center; 
            margin-bottom: 25px; 
            border-bottom: 3px solid #612c82; /* Tsinghua Purple */
            padding-bottom: 15px;
            width: 100%;
            max-width: 1000px;
        }
        .tsinghua-logo {
            font-family: "Times New Roman", Times, serif;
            font-size: clamp(24px, 5vw, 36px);
            font-weight: bold;
            color: #612c82;
            letter-spacing: 2px;
            margin: 0;
        }
        .header h1 { 
            font-size: clamp(18px, 4vw, 24px); 
            margin: 10px 0 5px 0; 
            color: #34495e;
        }

        .controls {
            background: white;
            padding: 15px 25px;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 15px;
            width: fit-content;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            gap: 25px;
            background: #ffffff;
            padding: clamp(10px, 3vw, 25px);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 1000px;
            box-sizing: border-box;
        }

        /* Canvas Responsive Scaling */
        canvas {
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            background: #fafafa;
            width: 100%;
            height: auto; /* Maintains aspect ratio */
            touch-action: none; /* Prevents scrolling while interacting with canvas */
        }

        .description-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            width: 100%;
            max-width: 1000px;
            gap: 20px;
            margin-top: 20px;
        }

        /* Stack cards on small screens */
        @media (max-width: 650px) {
            .description-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border-top: 5px solid #bdc3c7;
        }
        .card.metal { border-top-color: #e74c3c; }
        .card.semi { border-top-color: #27ae60; }
        
        h3 { margin-top: 0; color: #34495e; }
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
            text-transform: uppercase;
        }
        .btn {
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            border-radius: 25px;
            transition: all 0.3s ease;
            background: #612c82; 
            color: white;
            white-space: nowrap;
        }
        .btn:hover { background: #4a1d64; }
        .btn.active { background: #2c3e50; color: #f1c40f; }
        input[type=range] { cursor: pointer; min-width: 100px; }
    </style>
</head>
<body>

    <div class="header">
        <div class="tsinghua-logo">TSINGHUA UNIVERSITY</div>
        <h1>Microscopic Simulation: Photovoltaic Effect</h1>
        <p>Photovoltaic Practice Class - Engineering Physics Simulation</p>
    </div>

    <div class="controls">
        <button id="lightBtn" class="btn">SHINE LIGHT: OFF</button>
        <div style="display:flex; align-items:center; gap:10px;">
            <label for="intensity" style="font-size:0.9em; font-weight:bold;">Intensity:</label>
            <input type="range" id="intensity" min="1" max="10" value="5">
        </div>
    </div>

    <div class="container">
        <canvas id="mainCanvas" width="1000" height="420"></canvas>
    </div>

    <div class="description-grid">
        <div class="card metal">
            <h3>Metal Surface</h3>
            <p>Electrons gain kinetic energy but move <strong>randomly</strong>. Without a spatial asymmetry (field), the net displacement is zero. Energy is lost as <strong>heat</strong>.</p>
            <div id="metalStatus" class="status-badge" style="background: #fadbd8; color: #c0392b;">Status: No Net Current</div>
        </div>
        <div class="card semi">
            <h3>P-N Junction Semiconductor</h3>
            <p>The <strong>Built-in Electric Field</strong> ($E_{bi}$) breaks symmetry. It sweeps Photo-generated Carriers (E-H pairs) in opposite directions, creating <strong>Ordered Current</strong>.</p>
            <div id="semiStatus" class="status-badge" style="background: #d4efdf; color: #27ae60;">Status: Generating Power</div>
        </div>
    </div>

<script>
    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');
    const lightBtn = document.getElementById('lightBtn');
    const intensitySlider = document.getElementById('intensity');

    let isLightOn = false;
    let particles = [];
    const COUNT = 100;

    class Particle {
        constructor(isMetal, type) {
            this.isMetal = isMetal;
            this.type = type; 
            this.init();
        }

        init() {
            if (this.isMetal) {
                this.x = 50 + Math.random() * 400;
                this.y = 50 + Math.random() * 320;
            } else {
                this.x = 750 + (Math.random() - 0.5) * 30;
                this.y = 50 + Math.random() * 320;
            }
            this.vx = (Math.random() - 0.5) * 2;
            this.vy = (Math.random() - 0.5) * 2;
        }

        update() {
            let speedScale = isLightOn ? intensitySlider.value * 0.6 : 0.3;

            if (this.isMetal) {
                this.x += this.vx * speedScale;
                this.y += this.vy * speedScale;
                if (this.x < 30 || this.x > 470) this.vx *= -1;
                if (this.y < 30 || this.y > 370) this.vy *= -1;
            } else {
                if (isLightOn) {
                    const driftSpeed = speedScale * 0.8;
                    if (this.type === 'electron') {
                        this.x += driftSpeed; 
                    } else {
                        this.x -= driftSpeed;
                    }
                } else {
                    this.x += this.vx * 0.2;
                    this.y += this.vy * 0.2;
                }

                if (this.x > 970 || this.x < 530) this.init();
                if (this.y < 30 || this.y > 370) this.vy *= -1;
            }
        }

        draw() {
            ctx.beginPath();
            ctx.arc(this.x, this.y, 4, 0, Math.PI * 2);
            ctx.fillStyle = this.type === 'electron' ? '#3498db' : '#e74c3c';
            ctx.fill();
            if (isLightOn) {
                ctx.shadowBlur = 5;
                ctx.shadowColor = ctx.fillStyle;
            } else {
                ctx.shadowBlur = 0;
            }
            ctx.closePath();
        }
    }

    function setup() {
        particles = [];
        for (let i = 0; i < 40; i++) particles.push(new Particle(true, 'electron'));
        for (let i = 0; i < 20; i++) {
            particles.push(new Particle(false, 'electron'));
            particles.push(new Particle(false, 'hole'));
        }
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        ctx.fillStyle = "#f8f9fa";
        ctx.fillRect(20, 20, 460, 360); 
        ctx.fillStyle = "#fff9db";
        ctx.fillRect(520, 20, 460, 360); 

        ctx.fillStyle = "#7f8c8d";
        ctx.font = "bold 14px Arial";
        ctx.fillText("METAL (Al/Ag)", 40, 45);
        ctx.fillText("P-type", 540, 45);
        ctx.fillText("N-type", 920, 45);

        ctx.setLineDash([10, 5]);
        ctx.strokeStyle = "#bdc3c7";
        ctx.beginPath(); ctx.moveTo(750, 20); ctx.lineTo(750, 380); ctx.stroke();
        ctx.setLineDash([]);

        if (isLightOn) {
            ctx.strokeStyle = "#f39c12";
            ctx.lineWidth = 3;
            for(let i=0; i<4; i++) {
                let y = 100 + i*80;
                ctx.beginPath();
                ctx.moveTo(780, y); ctx.lineTo(720, y);
                ctx.lineTo(730, y-7); ctx.moveTo(720, y); ctx.lineTo(730, y+7);
                ctx.stroke();
            }
            ctx.fillStyle = "#f39c12";
            ctx.fillText("Built-in Field (E)", 705, 80);
        }

        ctx.strokeStyle = "#333";
        ctx.lineWidth = 2;
        ctx.strokeRect(600, 380, 300, 30); 
        if (isLightOn) {
            ctx.fillStyle = `rgba(241, 196, 15, ${intensitySlider.value/10})`;
            ctx.beginPath(); ctx.arc(750, 410, 15, 0, Math.PI*2); ctx.fill();
            ctx.stroke();
            ctx.fillStyle = "#000";
            ctx.font = "10px Arial";
            ctx.fillText("USEFUL WORK", 715, 415);
        }

        if (isLightOn) {
            ctx.fillStyle = `rgba(255, 241, 118, ${intensitySlider.value/25})`;
            ctx.fillRect(0,0, canvas.width, canvas.height);
        }

        particles.forEach(p => {
            p.update();
            p.draw();
        });

        document.getElementById('metalStatus').innerText = isLightOn ? "Status: DISORDERED (Heat)" : "Status: IDLE";
        document.getElementById('semiStatus').innerText = isLightOn ? "Status: ORDERED (Electricity)" : "Status: IDLE";

        requestAnimationFrame(draw);
    }

    lightBtn.onclick = () => {
        isLightOn = !isLightOn;
        lightBtn.innerText = isLightOn ? "SHINE LIGHT: ON" : "SHINE LIGHT: OFF";
        lightBtn.classList.toggle('active');
    };

    setup();
    draw();
</script>
</body>
</html>